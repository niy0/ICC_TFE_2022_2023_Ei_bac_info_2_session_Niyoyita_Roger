<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.mx/thymeleaf/layout" layout:decorate="~{layouts/main}">
<head>
  <meta charset="UTF-8">
  <title>Mes Commandes</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">
  <style>
    .container { max-width: 1200px; }
    .order-card {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      padding: 20px;
      transition: transform 0.2s;
    }
    .order-card:hover { transform: translateY(-5px); }
    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
      margin-bottom: 10px;
    }
    .order-id { font-size: 1.5rem; font-weight: bold; color: #007bff; }
    .order-status {
      padding: 5px 10px;
      border-radius: 5px;
      color: #fff;
    }
    .status-en_attente { background-color: #f0ad4e; }
    .status-en_cours { background-color: #5bc0de; }
    .status-en_preparation { background-color: #0275d8; }
    .status-commande_prete, .status-livree { background-color: #5cb85c; }
    .status-annulee { background-color: #d9534f; }
    .order-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    .order-info div { margin-bottom: 10px; }
    .order-total { font-size: 1.2rem; font-weight: bold; }
    .order-actions { text-align: right; }
    .pagination { justify-content: center; }
  </style>
</head>
<body>
<div class="container mt-4">
  <div layout:fragment="content">
    <div class="mt-5">
      <h2><i class="fas fa-info-circle"></i> Mes Commandes</h2>
      <div th:if="${#lists.isEmpty(commandes.content)}">
        <p>Vous n'avez pas encore passé de commande.</p>
      </div>
      <div th:each="commande : ${commandes.content}" class="order-card">
        <div class="order-card">
          <div class="order-header">
            <div class="order-id">Commande #<span th:text="${commande.id}"></span></div>
            <div class="order-status" th:classappend="${'status-' + commande.statut.toString().toLowerCase()}">
                <span th:text="${
                  (commande.statut.name() == 'EN_ATTENTE') ? 'En attente' :
                  (commande.statut.name() == 'EN_COURS') ? 'En cours' :
                  (commande.statut.name() == 'EN_PREPARATION') ? 'En préparation' :
                  (commande.statut.name() == 'COMMANDE_PRETE') ? 'Commande prête' :
                  (commande.statut.name() == 'LIVREE') ? 'Livrée' :
                  (commande.statut.name() == 'ANNULEE') ? 'Annulée' :
                  '' }"></span>
            </div>
          </div>
          <div class="order-info">
            <div>Date: <span th:text="${#dates.format(commande.dateCommande, 'dd/MM/yyyy HH:mm')}"></span></div>
            <div>Méthode: <span th:text="${commande.methodCommande == 'PICKUP' ? 'Récupérer au magasin' : 'Livraison'}"></span></div>
            <div class="order-total">Total: <span th:text="${commande.montantCommande} + ' €'"></span></div>
          </div>
          <div class="order-actions">
            <a th:href="@{/commande/detail/{id}(id=${commande.id})}" class="btn btn-info">Voir Détails</a>
          </div>
        </div>
      </div>
      <div th:if="${commandes.totalPages > 1}" class="d-flex justify-content-center">
        <nav aria-label="Page navigation">
          <ul class="pagination">
            <li class="page-item" th:classappend="${commandes.hasPrevious() ? '' : 'disabled'}">
              <a class="page-link" th:href="@{/mes-commandes(page=${commandes.number - 1}, size=${commandes.size})}">Précédent</a>
            </li>
            <li class="page-item" th:each="i : ${#numbers.sequence(1, commandes.totalPages)}"
                th:classappend="${i == commandes.number + 1 ? 'active' : ''}">
              <a class="page-link" th:href="@{/mes-commandes(page=${i - 1}, size=${commandes.size})}" th:text="${i}">1</a>
            </li>
            <li class="page-item" th:classappend="${commandes.hasNext() ? '' : 'disabled'}">
              <a class="page-link" th:href="@{/mes-commandes(page=${commandes.number + 1}, size=${commandes.size})}">Suivant</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>
</body>
</html>
