<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.mx/thymeleaf/layout" layout:decorate="~{layouts/main}">
<head>
  <meta charset="UTF-8">
  <title>Facture de la Commande</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">
  <!-- jQuery (Nécessaire avant les scripts Bootstrap) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <!-- Bootstrap Bundle JS (inclut Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
  <style>
    .invoice-box {
      max-width: 800px;
      margin: auto;
      padding: 30px;
      border: 1px solid #eee;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
      font-size: 16px;
      line-height: 24px;
      font-family: 'Helvetica Neue', 'Helvetica', Helvetica, Arial, sans-serif;
      color: #555;
    }
    .invoice-box table {
      width: 100%;
      line-height: inherit;
      text-align: left;
    }
    .invoice-box table td {
      padding: 5px;
      vertical-align: top;
    }
    .invoice-box table tr td:nth-child(2) {
      text-align: right;
    }
    .invoice-box table tr.top table td {
      padding-bottom: 20px;
    }
    .invoice-box table tr.top table td.title {
      font-size: 45px;
      line-height: 45px;
      color: #333;
    }
    .invoice-box table tr.information table td {
      padding-bottom: 40px;
    }
    .invoice-box table tr.heading td {
      background: #eee;
      border-bottom: 1px solid #ddd;
      font-weight: bold;
    }
    .invoice-box table tr.details td {
      padding-bottom: 20px;
    }
    .invoice-box table tr.item td {
      border-bottom: 1px solid #eee;
    }
    .invoice-box table tr.item.last td {
      border-bottom: none;
    }
    .invoice-box table tr.total td:nth-child(2) {
      border-top: 2px solid #eee;
      font-weight: bold;
    }
  </style>
</head>
<body>
<div class="container mt-4">
  <div layout:fragment="content">
    <div class="invoice-box">
      <table cellpadding="0" cellspacing="0">
        <tr class="top">
          <td colspan="2">
            <table>
              <tr>
                <td class="title">
                  <h2>Facture</h2>
                </td>
                <td>
                  Facture #: <span th:text="${commande.id}"></span><br>
                  Date: <span th:text="${#dates.format(commande.dateCommande, 'dd/MM/yyyy')}"></span><br>
                  Heure: <span th:text="${#dates.format(commande.dateCommande, 'HH:mm')}"></span>
                  <span th:if="${commande.dateDerniereMajStatut != null}">
                    Dernière mise à jour: <span th:text="${#dates.format(commande.dateDerniereMajStatut, 'dd/MM/yyyy HH:mm')}"></span>
                  </span>
                </td>
              </tr>
            </table>
          </td>
        </tr>
        <tr class="information">
          <td colspan="2">
            <table>
              <tr>
                <td>
                  <h4>Adresse de Facturation</h4>
                  <strong th:text="${commande.prenom} + ' ' + ${commande.nom}"></strong><br>
                  <span th:text="${commande.rue}"></span>, <span th:text="${commande.numero}"></span><br>
                  <span th:text="${commande.localite}" th:if="${commande.localite != null && !commande.localite.isEmpty()}"></span><br>
                  <span th:text="${commande.codePostal}"></span> <span th:text="${commande.ville}"></span><br>
                  <span th:text="${commande.departement}" th:if="${commande.departement != null && !commande.departement.isEmpty()}"></span><br>
                  <span th:text="${commande.pays}"></span><br>
                  <span th:text="${commande.email}"></span>
                </td>
                <td>
                  <h4>Adresse de Livraison</h4>
                  <strong th:text="${commande.prenom} + ' ' + ${commande.nom}"></strong><br>
                  <span th:text="${commande.rue}"></span>, <span th:text="${commande.numero}"></span><br>
                  <span th:text="${commande.localite}" th:if="${commande.localite != null && !commande.localite.isEmpty()}"></span><br>
                  <span th:text="${commande.codePostal}"></span> <span th:text="${commande.ville}"></span><br>
                  <span th:text="${commande.departement}" th:if="${commande.departement != null && !commande.departement.isEmpty()}"></span><br>
                  <span th:text="${commande.pays}"></span><br>
                  <span th:text="${commande.email}"></span>
                </td>
              </tr>
            </table>
          </td>
        </tr>
        <tr class="heading">
          <td>Méthode de Commande</td>
          <td th:text="${commande.methodCommande == 'PICKUP' ? 'Récupérer au magasin' : 'Livraison'}"></td>
        </tr>
        <tr class="heading">
          <td>Statut</td>
          <td th:text="${commande.statut}"></td>
        </tr>
        <tr class="heading">
          <td>Article</td>
          <td>Prix</td>
        </tr>
        <tr th:each="ligne : ${commande.lignesDeCommande}" class="item">
          <td>
            <span th:text="${ligne.produit.nom}"></span> (x<span th:text="${ligne.quantite}"></span>)<br>
            <small>Prix Unitaire: <span th:text="${ligne.prixUnitaire} + ' €'"></span></small>
          </td>
          <td th:text="${ligne.montantTotal} + ' €'"></td>
        </tr>
        <tr class="total">
          <td></td>
          <td>Sous-total: <span th:text="${commande.montantCommande} + ' €'"></span></td>
        </tr>
        <tr class="total">
          <td></td>
          <td>TVA (21%)</td>
        </tr>
        <tr class="total">
          <td></td>
          <td>Total TTC: <span th:text="${commande.montantCommande} + ' €'"></span></td>
        </tr>
      </table>
      <a href="/commandes" class="btn btn-primary mt-3">Retour à la liste des commandes</a>
      <div class="mt-5">
        <p><strong>Conditions générales de vente:</strong> Les articles retournés doivent être dans leur état d'origine. Consultez notre
          <a href="/conditions-generales" target="_blank">politique de retour</a> pour plus de détails.
        </p>
      </div>

    </div>
  </div>
</div>
</body>
</html>
